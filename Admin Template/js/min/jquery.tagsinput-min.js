!function($){var t=new Array,a=new Array;$.fn.doAutosize=function(t){var a=$(this).data("minwidth"),e=$(this).data("maxwidth"),i="",n=$(this),r=$("#"+$(this).data("tester_id"));if(i!==(i=n.val())){var d=i.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");r.html(d);var u=r.width(),o=u+t.comfortZone>=a?u+t.comfortZone:a,s=n.width(),l=s>o&&o>=a||o>a&&e>o;l&&n.width(o)}},$.fn.resetAutosize=function(t){var a=$(this).data("minwidth")||t.minInputWidth||$(this).width(),e=$(this).data("maxwidth")||t.maxInputWidth||$(this).closest(".tagsinput").width()-t.inputPadding,i="",n=$(this),r=$("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:n.css("fontSize"),fontFamily:n.css("fontFamily"),fontWeight:n.css("fontWeight"),letterSpacing:n.css("letterSpacing"),whiteSpace:"nowrap"}),d=$(this).attr("id")+"_autosize_tester";!$("#"+d).length>0&&(r.attr("id",d),r.appendTo("body")),n.data("minwidth",a),n.data("maxwidth",e),n.data("tester_id",d),n.css("width",a)},$.fn.addTag=function(e,i){return i=jQuery.extend({focus:!1,callback:!0},i),this.each(function(){var n=$(this).attr("id"),r=$(this).val().split(t[n]);if(""==r[0]&&(r=new Array),e=jQuery.trim(e),i.unique){var d=$(this).tagExist(e);1==d&&$("#"+n+"_tag").addClass("not_valid")}else var d=!1;if(""!=e&&1!=d){if($("<span>").addClass("tag").append($("<span>").text(e).append("&nbsp;&nbsp;"),$("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return $("#"+n).removeTag(escape(e))})).insertBefore("#"+n+"_addTag"),r.push(e),$("#"+n+"_tag").val(""),i.focus?$("#"+n+"_tag").focus():$("#"+n+"_tag").blur(),$.fn.tagsInput.updateTagsField(this,r),i.callback&&a[n]&&a[n].onAddTag){var u=a[n].onAddTag;u.call(this,e)}if(a[n]&&a[n].onChange){var o=r.length,u=a[n].onChange;u.call(this,$(this),r[o-1])}}}),!1},$.fn.removeTag=function(e){return e=unescape(e),this.each(function(){var n=$(this).attr("id"),r=$(this).val().split(t[n]);for($("#"+n+"_tagsinput .tag").remove(),str="",i=0;i<r.length;i++)r[i]!=e&&(str=str+t[n]+r[i]);if($.fn.tagsInput.importTags(this,str),a[n]&&a[n].onRemoveTag){var d=a[n].onRemoveTag;d.call(this,e)}}),!1},$.fn.tagExist=function(a){var e=$(this).attr("id"),i=$(this).val().split(t[e]);return jQuery.inArray(a,i)>=0},$.fn.importTags=function(t){var a=$(this).attr("id");$("#"+a+"_tagsinput .tag").remove(),$.fn.tagsInput.importTags(this,t)},$.fn.tagsInput=function(i){var n=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},i),r=0;return this.each(function(){if("undefined"==typeof $(this).attr("data-tagsinput-init")){$(this).attr("data-tagsinput-init",!0),n.hide&&$(this).hide();var i=$(this).attr("id");(!i||t[$(this).attr("id")])&&(i=$(this).attr("id","tags"+(new Date).getTime()+r++).attr("id"));var d=jQuery.extend({pid:i,real_input:"#"+i,holder:"#"+i+"_tagsinput",input_wrapper:"#"+i+"_addTag",fake_input:"#"+i+"_tag"},n);t[i]=d.delimiter,(n.onAddTag||n.onRemoveTag||n.onChange)&&(a[i]=new Array,a[i].onAddTag=n.onAddTag,a[i].onRemoveTag=n.onRemoveTag,a[i].onChange=n.onChange);var u='<div id="'+i+'_tagsinput" class="tagsinput"><div id="'+i+'_addTag">';if(n.interactive&&(u=u+'<input id="'+i+'_tag" value="" data-default="'+n.defaultText+'" />'),u+='</div><div class="tags_clear"></div></div>',$(u).insertAfter(this),$(d.holder).css("width",n.width),$(d.holder).css("min-height",n.height),$(d.holder).css("height",n.height),""!=$(d.real_input).val()&&$.fn.tagsInput.importTags($(d.real_input),$(d.real_input).val()),n.interactive){if($(d.fake_input).val($(d.fake_input).attr("data-default")),$(d.fake_input).css("color",n.placeholderColor),$(d.fake_input).resetAutosize(n),$(d.holder).bind("click",d,function(t){$(t.data.fake_input).focus()}),$(d.fake_input).bind("focus",d,function(t){$(t.data.fake_input).val()==$(t.data.fake_input).attr("data-default")&&$(t.data.fake_input).val(""),$(t.data.fake_input).css("color","#000000")}),void 0!=n.autocomplete_url){autocomplete_options={source:n.autocomplete_url};for(attrname in n.autocomplete)autocomplete_options[attrname]=n.autocomplete[attrname];void 0!==jQuery.Autocompleter?($(d.fake_input).autocomplete(n.autocomplete_url,n.autocomplete),$(d.fake_input).bind("result",d,function(t,a,e){a&&$("#"+i).addTag(a[0]+"",{focus:!0,unique:n.unique})})):void 0!==jQuery.ui.autocomplete&&($(d.fake_input).autocomplete(autocomplete_options),$(d.fake_input).bind("autocompleteselect",d,function(t,a){return $(t.data.real_input).addTag(a.item.value,{focus:!0,unique:n.unique}),!1}))}else $(d.fake_input).bind("blur",d,function(t){var a=$(this).attr("data-default");return""!=$(t.data.fake_input).val()&&$(t.data.fake_input).val()!=a?t.data.minChars<=$(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=$(t.data.fake_input).val().length)&&$(t.data.real_input).addTag($(t.data.fake_input).val(),{focus:!0,unique:n.unique}):($(t.data.fake_input).val($(t.data.fake_input).attr("data-default")),$(t.data.fake_input).css("color",n.placeholderColor)),!1});$(d.fake_input).bind("keypress",d,function(t){return e(t)?(t.preventDefault(),t.data.minChars<=$(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=$(t.data.fake_input).val().length)&&$(t.data.real_input).addTag($(t.data.fake_input).val(),{focus:!0,unique:n.unique}),$(t.data.fake_input).resetAutosize(n),!1):void(t.data.autosize&&$(t.data.fake_input).doAutosize(n))}),d.removeWithBackspace&&$(d.fake_input).bind("keydown",function(t){if(8==t.keyCode&&""==$(this).val()){t.preventDefault();var a=$(this).closest(".tagsinput").find(".tag:last").text(),e=$(this).attr("id").replace(/_tag$/,"");a=a.replace(/[\s]+x$/,""),$("#"+e).removeTag(escape(a)),$(this).trigger("focus")}}),$(d.fake_input).blur(),d.unique&&$(d.fake_input).keydown(function(t){(8==t.keyCode||String.fromCharCode(t.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/))&&$(this).removeClass("not_valid")})}}}),this},$.fn.tagsInput.updateTagsField=function(a,e){var i=$(a).attr("id");$(a).val(e.join(t[i]))},$.fn.tagsInput.importTags=function(e,n){$(e).val("");var r=$(e).attr("id"),d=n.split(t[r]);for(i=0;i<d.length;i++)$(e).addTag(d[i],{focus:!1,callback:!1});if(a[r]&&a[r].onChange){var u=a[r].onChange;u.call(e,e,d[i])}};var e=function(t){var a=!1;return 13==t.which?!0:("string"==typeof t.data.delimiter?t.which==t.data.delimiter.charCodeAt(0)&&(a=!0):$.each(t.data.delimiter,function(e,i){t.which==i.charCodeAt(0)&&(a=!0)}),a)}}(jQuery);