!function(t){"function"==typeof define&&define.amd?define(["jquery","moment"],t):"object"==typeof exports?t(require("jquery"),require("moment")):t(jQuery,moment)}(function($,t){function n(n,e){if(this.element=n,this.options=$.extend(!0,{},o,e),this.options.events.length&&(this.options.events=this.options.multiDayEvents?this.addMultiDayMomentObjectsToEvents(this.options.events):this.addMomentObjectToEvents(this.options.events)),this.month=this.options.startWithMonth?t(this.options.startWithMonth).startOf("month"):t().startOf("month"),this.options.constraints){if(this.options.constraints.startDate){var i=t(this.options.constraints.startDate);this.month.isBefore(i,"month")&&(this.month.set("month",i.month()),this.month.set("year",i.year()))}if(this.options.constraints.endDate){var a=t(this.options.constraints.endDate);this.month.isAfter(a,"month")&&this.month.set("month",a.month()).set("year",a.year())}}this._defaults=o,this._name=s,this.init()}var e="<div class='clndr-controls'><div class='clndr-control-button'><span class='clndr-previous-button'>previous</span></div><div class='month'><%= month %> <%= year %></div><div class='clndr-control-button rightalign'><span class='clndr-next-button'>next</span></div></div><table class='clndr-table' border='0' cellspacing='0' cellpadding='0'><thead><tr class='header-days'><% for(var i = 0; i < daysOfTheWeek.length; i++) { %><td class='header-day'><%= daysOfTheWeek[i] %></td><% } %></tr></thead><tbody><% for(var i = 0; i < numberOfRows; i++){ %><tr><% for(var j = 0; j < 7; j++){ %><% var d = j + i * 7; %><td class='<%= days[d].classes %>'><div class='day-contents'><%= days[d].day %></div></td><% } %></tr><% } %></tbody></table>",s="clndr",o={template:e,weekOffset:0,startWithMonth:null,clickEvents:{click:null,nextMonth:null,previousMonth:null,nextYear:null,previousYear:null,today:null,onMonthChange:null,onYearChange:null},targets:{nextButton:"clndr-next-button",previousButton:"clndr-previous-button",nextYearButton:"clndr-next-year-button",previousYearButton:"clndr-previous-year-button",todayButton:"clndr-today-button",day:"day",empty:"empty"},events:[],extras:null,dateParameter:"date",multiDayEvents:null,doneRendering:null,render:null,daysOfTheWeek:null,showAdjacentMonths:!0,adjacentDaysChangeMonth:!1,ready:null,constraints:null,forceSixRows:null};n.prototype.init=function(){if(this.daysOfTheWeek=this.options.daysOfTheWeek||[],!this.options.daysOfTheWeek){this.daysOfTheWeek=[];for(var n=0;7>n;n++)this.daysOfTheWeek.push(t().weekday(n).format("dd").charAt(0))}if(this.options.weekOffset&&(this.daysOfTheWeek=this.shiftWeekdayLabels(this.options.weekOffset)),!$.isFunction(this.options.render)){if(this.options.render=null,"undefined"==typeof _)throw new Error("Underscore was not found. Please include underscore.js OR provide a custom render function.");this.compiledClndrTemplate=_.template(this.options.template)}$(this.element).html("<div class='clndr'></div>"),this.calendarContainer=$(".clndr",this.element),this.bindEvents(),this.render(),this.options.ready&&this.options.ready.apply(this,[])},n.prototype.shiftWeekdayLabels=function(t){for(var n=this.daysOfTheWeek,e=0;t>e;e++)n.push(n.shift());return n},n.prototype.createDaysObject=function(n){daysArray=[];var e=n.startOf("month");if(this.eventsLastMonth=[],this.eventsThisMonth=[],this.eventsNextMonth=[],this.options.events.length)if(this.options.multiDayEvents){if(this.eventsThisMonth=$(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")===n.format("YYYY-MM")||this._clndrEndDateObject.format("YYYY-MM")===n.format("YYYY-MM")?!0:this._clndrStartDateObject.format("YYYY-MM")<=n.format("YYYY-MM")&&this._clndrEndDateObject.format("YYYY-MM")>=n.format("YYYY-MM")?!0:!1}).toArray(),this.options.showAdjacentMonths){var s=n.clone().subtract(1,"months"),o=n.clone().add(1,"months");this.eventsLastMonth=$(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")===s.format("YYYY-MM")||this._clndrEndDateObject.format("YYYY-MM")===s.format("YYYY-MM")?!0:this._clndrStartDateObject.format("YYYY-MM")<=s.format("YYYY-MM")&&this._clndrEndDateObject.format("YYYY-MM")>=s.format("YYYY-MM")?!0:!1}).toArray(),this.eventsNextMonth=$(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")===o.format("YYYY-MM")||this._clndrEndDateObject.format("YYYY-MM")===o.format("YYYY-MM")?!0:this._clndrStartDateObject.format("YYYY-MM")<=o.format("YYYY-MM")&&this._clndrEndDateObject.format("YYYY-MM")>=o.format("YYYY-MM")?!0:!1}).toArray()}}else if(this.eventsThisMonth=$(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==n.format("YYYY-MM")}).toArray(),this.options.showAdjacentMonths){var s=n.clone().subtract(1,"months"),o=n.clone().add(1,"months");this.eventsLastMonth=$(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==s.format("YYYY-MM")}).toArray(),this.eventsNextMonth=$(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==o.format("YYYY-MM")}).toArray()}var i=e.weekday()-this.options.weekOffset;if(0>i&&(i+=7),this.options.showAdjacentMonths)for(var a=0;i>a;a++){var r=t([n.year(),n.month(),a-i+1]);daysArray.push(this.createDayObject(r,this.eventsLastMonth))}else for(var a=0;i>a;a++)daysArray.push(this.calendarDay({classes:this.options.targets.empty+" last-month"}));for(var h=e.daysInMonth(),a=1;h>=a;a++){var r=t.utc([n.year(),n.month(),a]);daysArray.push(this.createDayObject(r,this.eventsThisMonth))}for(var a=1;daysArray.length%7!==0;){if(this.options.showAdjacentMonths){var r=t.utc([n.year(),n.month(),h+a]);daysArray.push(this.createDayObject(r,this.eventsNextMonth))}else daysArray.push(this.calendarDay({classes:this.options.targets.empty+" next-month"}));a++}if(this.options.forceSixRows&&42!==daysArray.length)for(var c=t(daysArray[daysArray.length-1].date).add(1,"days");daysArray.length<42;)this.options.showAdjacentMonths?(daysArray.push(this.createDayObject(t(c),this.eventsNextMonth)),c.add(1,"days")):daysArray.push(this.calendarDay({classes:this.options.targets.empty+" next-month"}));return daysArray},n.prototype.createDayObject=function(n,e){var s=[],o=t(),i=this,a=0,r=e.length;for(a;r>a;a++)if(i.options.multiDayEvents){var h=e[a]._clndrStartDateObject,c=e[a]._clndrEndDateObject;(n.isSame(h,"day")||n.isAfter(h,"day"))&&(n.isSame(c,"day")||n.isBefore(c,"day"))&&s.push(e[a])}else e[a]._clndrDateObject.date()==n.date()&&s.push(e[a]);var l="";return o.format("YYYY-MM-DD")==n.format("YYYY-MM-DD")&&(l+=" today"),n.isBefore(o,"day")&&(l+=" past"),s.length&&(l+=" event"),this.month.month()>n.month()?(l+=" adjacent-month",l+=this.month.year()===n.year()?" last-month":" next-month"):this.month.month()<n.month()&&(l+=" adjacent-month",l+=this.month.year()===n.year()?" next-month":" last-month"),this.options.constraints&&(this.options.constraints.startDate&&n.isBefore(t(this.options.constraints.startDate))&&(l+=" inactive"),this.options.constraints.endDate&&n.isAfter(t(this.options.constraints.endDate))&&(l+=" inactive")),!n.isValid()&&n.hasOwnProperty("_d")&&void 0!=n._d&&(n=t(n._d)),l+=" calendar-day-"+n.format("YYYY-MM-DD"),l+=" calendar-dow-"+n.weekday(),this.calendarDay({day:n.date(),classes:this.options.targets.day+l,events:s,date:n})},n.prototype.render=function(){this.calendarContainer.children().remove();var n=this.createDaysObject(this.month),e=this.month,s={daysOfTheWeek:this.daysOfTheWeek,numberOfRows:Math.ceil(n.length/7),days:n,month:this.month.format("MMMM"),year:this.month.year(),eventsThisMonth:this.eventsThisMonth,eventsLastMonth:this.eventsLastMonth,eventsNextMonth:this.eventsNextMonth,extras:this.options.extras};if(this.calendarContainer.html(this.options.render?this.options.render.apply(this,[s]):this.compiledClndrTemplate(s)),this.options.constraints){for(var o in this.options.targets)o!=this.options.targets.day&&this.element.find("."+this.options.targets[o]).toggleClass("inactive",!1);var i=null,a=null;this.options.constraints.startDate&&(i=t(this.options.constraints.startDate)),this.options.constraints.endDate&&(a=t(this.options.constraints.endDate)),i&&this.month.isSame(i,"month")&&this.element.find("."+this.options.targets.previousButton).toggleClass("inactive",!0),a&&this.month.isSame(a,"month")&&this.element.find("."+this.options.targets.nextButton).toggleClass("inactive",!0),i&&t(i).subtract(1,"years").isBefore(t(this.month).subtract(1,"years"))&&this.element.find("."+this.options.targets.previousYearButton).toggleClass("inactive",!0),a&&t(a).add(1,"years").isAfter(t(this.month).add(1,"years"))&&this.element.find("."+this.options.targets.nextYearButton).toggleClass("inactive",!0),(i&&i.isAfter(t(),"month")||a&&a.isBefore(t(),"month"))&&this.element.find("."+this.options.targets.today).toggleClass("inactive",!0)}this.options.doneRendering&&this.options.doneRendering.apply(this,[])},n.prototype.bindEvents=function(){var t=$(this.element),n=this;t.on("click","."+this.options.targets.day,function(t){if(n.options.clickEvents.click){var e=n.buildTargetObject(t.currentTarget,!0);n.options.clickEvents.click.apply(n,[e])}n.options.adjacentDaysChangeMonth&&($(t.currentTarget).is(".last-month")?n.backActionWithContext(n):$(t.currentTarget).is(".next-month")&&n.forwardActionWithContext(n))}),t.on("click","."+this.options.targets.empty,function(t){if(n.options.clickEvents.click){var e=n.buildTargetObject(t.currentTarget,!1);n.options.clickEvents.click.apply(n,[e])}n.options.adjacentDaysChangeMonth&&($(t.currentTarget).is(".last-month")?n.backActionWithContext(n):$(t.currentTarget).is(".next-month")&&n.forwardActionWithContext(n))}),t.on("click","."+this.options.targets.previousButton,{context:this},this.backAction).on("click","."+this.options.targets.nextButton,{context:this},this.forwardAction).on("click","."+this.options.targets.todayButton,{context:this},this.todayAction).on("click","."+this.options.targets.nextYearButton,{context:this},this.nextYearAction).on("click","."+this.options.targets.previousYearButton,{context:this},this.previousYearAction)},n.prototype.buildTargetObject=function(n,e){var s={element:n,events:[],date:null};if(e){var o,i=n.className.indexOf("calendar-day-");0!==i?(o=n.className.substring(i+13,i+23),s.date=t(o)):s.date=null,this.options.events&&(s.events=$.makeArray(this.options.multiDayEvents?$(this.options.events).filter(function(){return(s.date.isSame(this._clndrStartDateObject,"day")||s.date.isAfter(this._clndrStartDateObject,"day"))&&(s.date.isSame(this._clndrEndDateObject,"day")||s.date.isBefore(this._clndrEndDateObject,"day"))}):$(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM-DD")==o})))}return s},n.prototype.forwardAction=function(t){var n=t.data.context;n.forwardActionWithContext(n)},n.prototype.backAction=function(t){var n=t.data.context;n.backActionWithContext(n)},n.prototype.backActionWithContext=function(n){if(!n.element.find("."+n.options.targets.previousButton).hasClass("inactive")){var e=!n.month.isSame(t(n.month).subtract(1,"months"),"year");n.month.subtract(1,"months"),n.render(),n.options.clickEvents.previousMonth&&n.options.clickEvents.previousMonth.apply(n,[t(n.month)]),n.options.clickEvents.onMonthChange&&n.options.clickEvents.onMonthChange.apply(n,[t(n.month)]),e&&n.options.clickEvents.onYearChange&&n.options.clickEvents.onYearChange.apply(n,[t(n.month)])}},n.prototype.forwardActionWithContext=function(n){if(!n.element.find("."+n.options.targets.nextButton).hasClass("inactive")){var e=!n.month.isSame(t(n.month).add(1,"months"),"year");n.month.add(1,"months"),n.render(),n.options.clickEvents.nextMonth&&n.options.clickEvents.nextMonth.apply(n,[t(n.month)]),n.options.clickEvents.onMonthChange&&n.options.clickEvents.onMonthChange.apply(n,[t(n.month)]),e&&n.options.clickEvents.onYearChange&&n.options.clickEvents.onYearChange.apply(n,[t(n.month)])}},n.prototype.todayAction=function(n){var e=n.data.context,s=!e.month.isSame(t(),"month"),o=!e.month.isSame(t(),"year");e.month=t().startOf("month"),e.options.clickEvents.today&&e.options.clickEvents.today.apply(e,[t(e.month)]),s&&(e.render(),e.month=t(),e.options.clickEvents.onMonthChange&&e.options.clickEvents.onMonthChange.apply(e,[t(e.month)]),o&&e.options.clickEvents.onYearChange&&e.options.clickEvents.onYearChange.apply(e,[t(e.month)]))},n.prototype.nextYearAction=function(n){var e=n.data.context;e.element.find("."+e.options.targets.nextYearButton).hasClass("inactive")||(e.month.add(1,"years"),e.render(),e.options.clickEvents.nextYear&&e.options.clickEvents.nextYear.apply(e,[t(e.month)]),e.options.clickEvents.onMonthChange&&e.options.clickEvents.onMonthChange.apply(e,[t(e.month)]),e.options.clickEvents.onYearChange&&e.options.clickEvents.onYearChange.apply(e,[t(e.month)]))},n.prototype.previousYearAction=function(n){var e=n.data.context;e.element.find("."+e.options.targets.previousYear).hasClass("inactive")||(e.month.subtract(1,"years"),e.render(),e.options.clickEvents.previousYear&&e.options.clickEvents.previousYear.apply(e,[t(e.month)]),e.options.clickEvents.onMonthChange&&e.options.clickEvents.onMonthChange.apply(e,[t(e.month)]),e.options.clickEvents.onYearChange&&e.options.clickEvents.onYearChange.apply(e,[t(e.month)]))},n.prototype.forward=function(n){return this.month.add(1,"months"),this.render(),n&&n.withCallbacks&&(this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[t(this.month)]),0===this.month.month()&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[t(this.month)])),this},n.prototype.back=function(n){return this.month.subtract(1,"months"),this.render(),n&&n.withCallbacks&&(this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[t(this.month)]),11===this.month.month()&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[t(this.month)])),this},n.prototype.next=function(t){return this.forward(t),this},n.prototype.previous=function(t){return this.back(t),this},n.prototype.setMonth=function(n,e){return this.month.month(n),this.render(),e&&e.withCallbacks&&this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[t(this.month)]),this},n.prototype.nextYear=function(n){return this.month.add(1,"year"),this.render(),n&&n.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[t(this.month)]),this},n.prototype.previousYear=function(n){return this.month.subtract(1,"year"),this.render(),n&&n.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[t(this.month)]),this},n.prototype.setYear=function(n,e){return this.month.year(n),this.render(),e&&e.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[t(this.month)]),this},n.prototype.setEvents=function(t){return this.options.events=this.options.multiDayEvents?this.addMultiDayMomentObjectsToEvents(t):this.addMomentObjectToEvents(t),this.render(),this},n.prototype.addEvents=function(t){return this.options.events=this.options.multiDayEvents?$.merge(this.options.events,this.addMultiDayMomentObjectsToEvents(t)):$.merge(this.options.events,this.addMomentObjectToEvents(t)),this.render(),this},n.prototype.removeEvents=function(t){for(var n=this.options.events.length-1;n>=0;n--)1==t(this.options.events[n])&&this.options.events.splice(n,1);return this.render(),this},n.prototype.addMomentObjectToEvents=function(n){var e=this,s=0,o=n.length;for(s;o>s;s++)n[s]._clndrDateObject=t(n[s][e.options.dateParameter]);return n},n.prototype.addMultiDayMomentObjectsToEvents=function(n){var e=this,s=0,o=n.length;for(s;o>s;s++)n[s]._clndrStartDateObject=t(n[s][e.options.multiDayEvents.startDate]),n[s]._clndrEndDateObject=t(n[s][e.options.multiDayEvents.endDate]);return n},n.prototype.calendarDay=function(t){var n={day:"",classes:this.options.targets.empty,events:[],date:null};return $.extend({},n,t)},$.fn.clndr=function(t){if(1===this.length){if(!this.data("plugin_clndr")){var e=new n(this,t);return this.data("plugin_clndr",e),e}}else if(this.length>1)throw new Error("CLNDR does not support multiple elements yet. Make sure your clndr selector returns only one element.")}});